# Preventing SQLI
___

## Overview
- Primary Defences
    - *__Option 1: Use of prepared statements(Parameterized Queries)__*

    >__These may be bypassed of if implemented incorrectly may be vulnerable__
    >- Option 2: Use stored procedures(__Partial__)
    >- Option 3: White list input validation(__Partial__)
    >- Option 4: Escaping all user supplied input(__Partial__)

- Additional Defences
    - Also: Enforcing the least amount of privelege to perform a task.
    - Also: Performing whitelist input validation as a secondary defence
___

### Primary Defences

###### Option 1
>Vunerable code
```js
String query = "SELECT account_balance FROM user_data WHERE user_name = "+ request.getParameter("customerName");
try {
    Statement statement connection.createStatement(...);
    ResultSet rules = statement.executeQuery(query);
    ...
}
```

__ISSUE__

>userName(user input) is placed directly into the query user_name(sql statement)

__SOLUTION__

The construction of the SQL statement is in two steps.
>1. The application specifies the structure with placeholders for each user.
2. The application specifies content for each placeholder.

This ensures that usersupplied input cannot be interpreted as SQL because the structure has been pre defined in the first step.

>Good code
```js
String custName = request.getParameter("customerName"); // Should also be validated
// Perform input validation to detect attacks.
String query = "SELECT account_balance FROM user_data WHERE user_name = ?";
PreparedStatement pstmt = connection.prepareStatement( query );
pstmt.setString(1, custName);
ResultSet rules = pstmt.executeQuery();
```


###### Option 2
- Stored procedure is batch of statements grouped together and stored in a DB.
- Still not safe, need to be called in a parameterized way.
- this is generally used if the parameters are user controllable( They should'nt be but sometimes are )



###### Option 3
- Define values that are authorized, everything else isconsidered un-authorized.
- Usfule for values that cannot be specified as placeholders. ie. __table_name__ will only accept table_name and no other characters.



###### Option 4
- Escape all user input should only be used as a last resort.

___

### Aditional Defences
- Give the least amount of privelege to perform the tasks to the application.
    - If an attacker gains access and the privelege is set to root then they take control over the application and anything else it is connected to.
- Remove redundant functionality from the database od disabled.
    - Like allowing functions to perform queries and also functions that allow root commands from within. Network connections and so on.
- Ensure benchmarks are inuse and applied to the database
- Fully patched as soon as possible.
- Whitelist parameters as previously mentioned.
